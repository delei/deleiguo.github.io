<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>JVM类型与模式[JAVA -VERSION] | DeleiGuo</title>
  <meta name="author" content="DeleiGuo">
  
  <meta name="description" content="deleiguo,DeleiGuo,裤子_Delei,裤子_DeleiGuo,个人博客,技术博客,Java">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="JVM类型与模式[JAVA -VERSION]"/>
  <meta property="og:site_name" content="DeleiGuo"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/plugins/font-awesome-4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/plugins/highlight/styles/github.css">
  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css">
  <link rel="stylesheet" href="/plugins/bootstrap-3.3.0/css/bootstrap.min.css">
  <!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script><![endif]-->

</head>


<body>
  <header id="header" class="">
        <div class="container">
          <a class="home-link" href="/">
  <h1 class="site-title animated zoomIn">DeleiGuo</h1>
  <h2 class="site-title-description animated zoomInLeft">Target、Focus、Patient</h2>
</a>
<div class="clearfix"></div>

        </div>
  </header>
  <nav id="main-nav" class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#ddnavbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
          </div>
          <div id="ddnavbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              
                <li><a href="/"><i class="fa fa-home">&nbsp;</i>首页</a></li>
              
                <li><a href="/archives"><i class="fa fa-archive">&nbsp;</i>归档</a></li>
              
                <li><a href="/books"><i class="fa fa-book">&nbsp;</i>书籍库</a></li>
              
                <li><a href="/about"><i class="fa fa-user">&nbsp;</i>关于</a></li>
              
            </ul>
          </div>
    </div>
    <div class="clearfix"></div>
  </nav>
  <div id="content">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-08-17T08:01:10.000Z"><a href="/2016/08/17/jvm-type-and-mode/">2016-08-17</a></time>
      
      
  
    <h1 class="title"><strong>JVM类型与模式[JAVA -VERSION]</strong></h1>
  


    </header>
    <div class="entry">
      
        <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>基本上一开始学习Java，就接触到第一个Java的命令:<code>java -version</code><br>这个命令最常用的就是用来查看当前服务器的JDK环境版本，以此验证服务器环境变量是否已正确的设置好JDK。<br>最常见的结果一般有两种：</p>
<ul>
<li><p><strong>Sun JDK</strong>:</p>
<pre><code>delei@DeleitekiMBP:~$ java -version
java version &quot;1.7.0_79&quot;
Java(TM) SE Runtime Environment (build 1.7.0_79-b15)
Java HotSpot(TM) 64-Bit Server VM (build 24.79-b02, mixed mode)
</code></pre></li>
<li><p><strong>Open JDK</strong>:</p>
<pre><code>root@ubuntu-server:~# java -version
java version &quot;1.7.0_95&quot;
OpenJDK Runtime Environment (IcedTea 2.6.4) (7u95-2.6.4-0ubuntu0.15.10.1)
OpenJDK 64-Bit Server VM (build 24.95-b01, mixed mode)
</code></pre></li>
</ul>
<a id="more"></a>
<blockquote>
<p>第一行:JDK的版本号<br>第二行：JDK的运行环境</p>
</blockquote>
<p>但第三行是指的什么，在一开始没留意也不理解这一行包含着哪些信息，这里以Sun JDK为例来稍微深入看一下.</p>
<pre><code>  Java HotSpot(TM) 64-Bit Server VM (build 24.79-b02, mixed mode)
</code></pre><ul>
<li><p>Java HotSpot(TM)</p>
<ul>
<li>这是从Sun公司开始，到Oracle后一直使用的虚拟机;</li>
<li>其实JVM只是一个规范，可以自己实现虚拟机；</li>
<li>目前市面上常用的商业虚拟机有：HotSpot(Oracle 和 openjdk),IBM的J9 vm，Azul Systems 的Zing等 <a href="http://www.zhihu.com/question/29265430?sort=created" target="_blank" rel="external">zhihu</a>;</li>
<li>其他虚拟机：<a href="https://en.wikipedia.org/wiki/Comparison_of_Java_virtual_machines" target="_blank" rel="external">wikipedia</a></li>
</ul>
</li>
<li><p>64-Bit</p>
<ul>
<li>如果安装的是64位的则是64-bit,如果安装是32位，则为32-bit。</li>
<li>这里不是服务器的操作系统，而是指的当前安装JDK</li>
</ul>
</li>
<li><p>Server VM</p>
<ul>
<li>Server VM</li>
<li>Client VM</li>
</ul>
</li>
<li><p>mixed mode</p>
<ul>
<li>mixed mode:混合模式</li>
<li>class data sharing：类数据共享</li>
<li>interpreted mode:解释模式</li>
</ul>
</li>
</ul>
<hr>
<h1 id="JVM类型"><a href="#JVM类型" class="headerlink" title="JVM类型"></a>JVM类型</h1><p>首先要知道的的是Server VM和Client VM可以理解是不同的虚拟机。<br>如果操作系统是64位的，只能是Server VM，Client VM只有在32位上才有。<a href="http://docs.oracle.com/javase/7/docs/technotes/guides/vm/server-class.html" target="_blank" rel="external">Oracle官方</a></p>
<p>Server VM和Client VM有什么区别？在官网的FAQ中有如下的描述：</p>
<p><strong>JIT Compiler</strong><br>1.<strong>What’s the difference between the -client and -server systems?</strong></p>
<pre><code class="lang-XML">These two systems are different binaries. They are essentially two different compilers (JITs)interfacing to the same runtime system. The client system is optimal for applications which need fast startup times or small footprints, the server system is optimal for applications where the overall performance is most important. In general the client system is better suited for interactive applications such as GUIs. Some of the other differences include the compilation policy,heap defaults, and inlining policy.
</code></pre>
<blockquote>
<p> 大致翻译：<br> 这两个JVM采用不同的编译器。<br> Client JVM适合快速启动和较小内存的，它适合强调交互的应用，比如GUI(桌面级应用界面)；<br> Server JVM则是偏重执行时候的效率的。<br> 其他不同的地方”编译策略”、”默认堆大小”、”内嵌策略”</p>
</blockquote>
<p>2.<strong>Where do I get the server and client systems?</strong></p>
<pre><code>Client and server systems are both downloaded with the 32-bit Solaris and Linux downloads. For 32-bit Windows, if you download the JRE, you get only the client, you&#39;ll need to download the SDK to get both systems.

For 64-bit, only the server system is included. On Solaris, the 64-bit JRE is an overlay on top of the 32-bit distribution. However, on Linux and Windows, it&#39;s a completely separate distribution.
</code></pre><blockquote>
<p> 主要内容翻译：<br> 在32位的系统中，如果下载JRE,则只有client；<br> 从Java SE 5.0开始，在64位的系统中，默认的时候Server，32位的默认</p>
</blockquote>
<p>以上是从官方得到的原理/规范使用上的一些说明。接下来看在实际当中，如何切换Server VM和Client VM：</p>
<ul>
<li>想要在windows系统中进行切换，需要下载JDK而不是JRE;</li>
<li>在Windows 系统中，找到JDK(%JAVA_HOME%)安装的目录<code>/jre/lib</code>，该目录下会有<code>server</code>和<code>client</code>两个不同的目录;</li>
</ul>
<ol>
<li><p>命令切换(推荐)<br>在CMD/终端命令中，执行<code>java -server -version</code>和<code>java -client -version</code>即可切换;</p>
</li>
<li><p>修改文件(永久切换)<br>在<code>jre/lib/i386/</code>(32位的JDK有i386文件夹)，编辑修改jvm.cfg文件</p>
</li>
</ol>
<pre><code># List of JVMs that can be used as an option to java, javac, etc.
# Order is important -- first in this list is the default JVM.
# NOTE that this both this file and its format are UNSUPPORTED and
# WILL GO AWAY in a future release.
#
# You may also select a JVM in an arbitrary location with the
# &quot;-XXaltjvm=&lt;jvm_dir&gt;&quot; option, but that too is unsupported
# and may not be available in a future release.
#
-client KNOWN
-server KNOWN
-hotspot ALIASED_TO -client
-classic WARN
-native ERROR
-green ERROR
</code></pre><p> <code># Order is important -- first in this list is the default JVM.</code><br> 第一行的配置则为默认的JVM，这里第一行是-client，所有默认是Client VM;<br> 要想用Server VM，则将第二行与第三行调换位置保存即可;</p>
<p><strong>应用场景</strong></p>
<ol>
<li>我们时常会在开发/生产环境中对web 服务器调整JVM的参数，一般来说目前服务器都是64位的，可以先用java -version来查看环境;</li>
<li>根据应用的场景需要，在jvm中加上<code>-server</code> 参数;</li>
</ol>
<hr>
<h1 id="JVM运行模式"><a href="#JVM运行模式" class="headerlink" title="JVM运行模式"></a>JVM运行模式</h1><p>在CMD/终端命令中，执行<code>java -X</code></p>
<pre><code>root@ubuntu-server:~# java -X
    -Xmixed           mixed mode execution (default)
    -Xint             interpreted mode execution only
</code></pre><p>在此可以知道mixed是默认的模式；<br>JVM模式有：-Xint, -Xcomp, 和 -Xmixed</p>
<ul>
<li><p><strong> -Xint</strong><br>在解释模式(interpreted mode)下，-Xint标记会强制JVM执行所有的字节码，当然这会降低运行速度，通常低10倍或更多。</p>
</li>
<li><p><strong> -Xcomp</strong><br>-Xcomp参数与它（-Xint）正好相反，JVM在第一次使用时会把所有的字节码编译成本地代码，从而带来最大程度的优化。这听起来不错，因为这完全绕开了缓慢的解释器</p>
</li>
<li><p><strong>-Xmixed</strong><br>混合模式(mixed mode)，是JVM的默认工作模式。它会同时使用编译模式和解释模式。对于字节码中多次被调用的部分，JVM会将其编译成本地代码以提高执行效率；而被调用很少（甚至只有一次）的方法在解释模式下会继续执行，从而减少编译和优化成本。JIT编译器在运行时创建方法使用文件，然后一步一步的优化每一个方法，有时候会主动的优化应用的行为。这些优化技术，比如积极的分支预测（optimistic branch prediction），如果不先分析应用就不能有效的使用。这样将频繁调用的部分提取出来，编译成本地代码，也就是在应用中构建某种热点（即HotSpot，这也是HotSpot JVM名字的由来）。使用混合模式可以获得最好的执行效率。</p>
</li>
</ul>
<p>在CMD/终端命令中，可以直接通过命令来切换模式：</p>
<pre><code>root@ubuntu-server:~# java -Xint -version
java version &quot;1.7.0_95&quot;
OpenJDK Runtime Environment (IcedTea 2.6.4) (7u95-2.6.4-0ubuntu0.15.10.1)
OpenJDK 64-Bit Server VM (build 24.95-b01, interpreted mode)

root@ubuntu-server:~# java -Xcomp -version
java version &quot;1.7.0_95&quot;
OpenJDK Runtime Environment (IcedTea 2.6.4) (7u95-2.6.4-0ubuntu0.15.10.1)
OpenJDK 64-Bit Server VM (build 24.95-b01, compiled mode)
</code></pre><p><strong> 代码验证</strong><br>我们通过一个小的Java代码来验证下不同mode下的执行耗时(Server VM)</p>
<pre><code class="lang-JAVA">public class JVMModeTest {

    private static void test() {//循环++
        for (int i =0;i&lt;1000000000;i++) {
        }
    }

    public static void main(String[] args) {
        long start = System.currentTimeMillis();
        test();
        long end = System.currentTimeMillis();
        System.out.println(end-start);//打印执行耗时
    }

}
</code></pre>
<p>结果如下：</p>
<pre><code>root@ubuntu-server:~/work/java$ java -Xcomp JVMModeTest
2
root@ubuntu-server:~/work/java$ java -Xint JVMModeTest
28562
root@ubuntu-server:~/work/java$ java -Xmixed JVMModeTest
18
</code></pre><blockquote>
<p>引用原文：<a href="https://book.douban.com/subject/24722612/" target="_blank" rel="external">深入理解Java虚拟机：JVM高级特性与最佳实践（第2版）</a></p>
</blockquote>
<p>由于即时编译器编译本地代码需要占用程序运行时间，要编译出优化程度更高的代码，所花费的时间可能更长；而且想要编译出优化程度更高的代码，解释器可能还要替编译器收集性能监控信息，这对解释执行的速度也有影响。为了在程序启动响应速度与运行效率之间达到最佳平衡，HotSpot虚拟机还会逐渐启用分层编译（Tiered Compilation）[4]的策略，分层编译的概念在JDK 1.6时期出现，后来一直处于改进阶段，最终在JDK 1.7的Server模式虚拟机中作为默认编译策略被开启。分层编译根据编译器编译、优化的规模与耗时，划分出不同的编译层次，其中包括：</p>
<ul>
<li><p>第0层，程序解释执行，解释器不开启性能监控功能（Profiling），可触发第1层编译。</p>
</li>
<li><p>第1层，也称为C1编译，将字节码编译为本地代码，进行简单、可靠的优化，如有必要将加入性能监控的逻辑。</p>
</li>
<li><p>第2层（或2层以上），也称为C2编译，也是将字节码编译为本地代码，但是会启用一些编译耗时较长的优化，甚至会根据性能监控信息进行一些不可靠的激进优化。</p>
</li>
</ul>
<p>实施分层编译后，Client Compiler和Server Compiler将会同时工作，许多代码都可能会被多次编译，用Client Compiler获取更高的编译速度，用Server Compiler来获取更好的编译质量，在解释执行的时候也无须再承担收集性能监控信息的任务</p>
<p>注：<br>[1] 在虚拟机中习惯将Client Compiler称为C1，将Server Compiler称为C2。</p>
<hr>
<h1 id="参考-引用"><a href="#参考-引用" class="headerlink" title="参考/引用"></a>参考/引用</h1><p><a href="http://my.oschina.net/itblog/blog/507822" target="_blank" rel="external">http://my.oschina.net/itblog/blog/507822</a><br><a href="http://ifeve.com/useful-jvm-flags-part-1-jvm-types-and-compiler-modes-2/" target="_blank" rel="external">http://ifeve.com/useful-jvm-flags-part-1-jvm-types-and-compiler-modes-2/</a><br><a href="https://book.douban.com/subject/24722612/" target="_blank" rel="external">深入理解Java虚拟机：JVM高级特性与最佳实践（第2版）</a></p>
<p><a href="http://www.oracle.com/technetwork/java/hotspotfaq-138619.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/hotspotfaq-138619.html</a><br><a href="http://docs.oracle.com/javase/7/docs/technotes/guides/vm/server-class.html" target="_blank" rel="external">http://docs.oracle.com/javase/7/docs/technotes/guides/vm/server-class.html</a></p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/tec/">TEC-技术</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/JVM/"># JVM</a>
  </div>


        <br/>
<pre><code><b>*版权声明</b>:如未特殊标注说明，本文为原创,如需转载请注明来自,本文链接为<b><a href="/2016/08/17/jvm-type-and-mode/" target="_blank" title="JVM类型与模式[JAVA -VERSION]">DeleiGuo:JVM类型与模式[JAVA -VERSION]</a></b>.</code></pre>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


</div></div>
    <aside id="sidebar" class="alignright">
  <!-- <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:www.deleiguo.com">
  </form>
</div> -->


  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/pri/">PRI-文章</a><small>2</small></li>
  
    <li><a href="/categories/tec/">TEC-技术</a><small>15</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/DeleiGuo/">DeleiGuo</a><small>1</small></li>
  
    <li><a href="/tags/JVM/">JVM</a><small>10</small></li>
  
    <li><a href="/tags/Java/">Java</a><small>3</small></li>
  
    <li><a href="/tags/Linux/">Linux</a><small>3</small></li>
  
    <li><a href="/tags/Mac/">Mac</a><small>1</small></li>
  
    <li><a href="/tags/Team/">Team</a><small>1</small></li>
  
  </ul>
</div>


  
  <div class="widget tag">
    <h3 class="title">归档</h3>
	<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2999/10/">2999年10月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">2017年02月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">2016年12月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">2016年11月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">2016年10月</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">2016年08月</a><span class="archive-list-count">1</span></li></ul>
  </div>



  <div class="widget tag">
    <h3 class="title">书签</h3>
    <ul class="entry">
        <li><i class="fa fa-link"></i>&nbsp;&nbsp;<a href="https://my.myssvpn.com/aff.php?aff=255" target="_blank" nofollow>翻墙：ShadowsocksR</a>
        </li>
        <li><i class="fa fa-link"></i>&nbsp;&nbsp;<a href="http://calvin1978.blogcn.com" target="_blank" nofollow>江南白衣</a>
        </li>
        <li><i class="fa fa-link"></i>&nbsp;&nbsp;<a href="http://coolshell.cn" target="_blank" nofollow>酷壳–CoolShell.cn</a>
        </li>
        <li><i class="fa fa-link"></i>&nbsp;&nbsp;<a href="http://www.hollischuang.com" target="_blank" nofollow>HollisChuang's Blog</a>
        </li>
        <li><i class="fa fa-link"></i>&nbsp;&nbsp;<a href="http://ifeve.com" target="_blank" nofollow>并发编程网-ifeve.com</a>
        </li>
        <li><i class="fa fa-link"></i>&nbsp;&nbsp;<a href="http://www.kuqin.com" target="_blank" nofollow>酷勤网</a>
        </li>
        <li><i class="fa fa-link"></i>&nbsp;&nbsp;<a href="http://grepcode.com" target="_blank" nofollow>grepcode.com</a>
        </li>
        <li><i class="fa fa-link"></i>&nbsp;&nbsp;<a href="http://www.importnew.com" target="_blank" nofollow>ImportNew</a>
        </li>
        <li><i class="fa fa-link"></i>&nbsp;&nbsp;<a href="http://www.jobbole.com" target="_blank" nofollow>伯乐在线</a>
        </li>
        <li><i class="fa fa-link"></i>&nbsp;&nbsp;<a href="http://wiki.jikexueyuan.com" target="_blank" nofollow>极客学院wiki</a>
        </li>
        <li><i class="fa fa-link"></i>&nbsp;&nbsp;<a href="https://segmentfault.com" target="_blank" nofollow>segmentfault</a>
        </li>
        <li><i class="fa fa-link"></i>&nbsp;&nbsp;<a href="http://hao.shejidaren.com/index.html" target="_blank" nofollow>设计导航</a>
        </li>
    </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer">
      <div class="container">
          <h5 style="color:#333;padding-top:15px;">
              I know no such things as genius,it is nothing but labor and diligence.<br/>
              -哪有什么天才之说，不过是勤奋
          </h5>
          <br/>
          <div class="text-center">
  
  &copy; 2017 DeleiGuo
  
  &nbsp;&nbsp;
  湘ICP备16012107号-1
  <br/>
  Powered by <a href="https://hexo.io" target="_blank">Hexo</a>. Theme by <a href="https://hexo.io/hexo-theme-light/" target="_blank">Light</a>.
</div>
<div class="dd-github-camo">
  <a href="https://github.com/delei"><img style="position: absolute; top: 0; right: 0; border: 0;" src="/images/githubuser.png" alt="Fork me on GitHub"></a>
</div>
<div class="clearfix"></div>

      </div>
  </footer>
  <div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;">
<a title="返回顶部"><img src="/images/scrollup.png"/></a>
</div>

<script src="/plugins/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/plugins/highlight/highlight.pack.js"></script>
<script src="/plugins/bootstrap-3.3.0/js/bootstrap.min.js"></script>
<script src="/js/totop.js"></script>
<script type="text/javascript">
(function($){
  hljs.initHighlightingOnLoad();
})(jQuery);
</script>


</body>
</html>
